---
title: "A geographical statistical approach to the 2018 New Zealand Index of Multiple Deprevation"
subtitle: "GEOG 351: Quantitative Analysis"
author: "Alice Clauss (260945446)"
format:
  revealjs: 
    theme: simple
editor: visual
bibliography: references.bib
---

## Stages

-   Background

-   Methods

-   Results

-   Conclusions

# Background

## Background: Data

My project focuses on the New Zealand Index of Multiple Deprivation (IMD), which was created in 2013 and updated in 2018, which is a ranking of deprivation by data zones in New Zealand [@exeter2018].

I also used data from the 2018 New Zealand Census at the statistical area two level, focusing on education qualifications, typical methods of travel to work, and Maori heritage [@statsnz2020].

## Background: Index weighting {.smaller}

::: columns
::: {.column width="40%"}
```{r IMD Data, echo=TRUE}
imd18 <- readxl::read_excel("IMD2018.xlsx", sheet = "IMD18") # Import data
ncol(imd18) # Number of columns
nrow(imd18) # Number of entries
```

-   6180 entries (excluding the column names' row)
-   these are at the different geographic level than census data
-   only 15 real variables, with duplicates
:::

::: {.column width="60%"}
![Figure 1. Weights of the IMD [@exeter2018].](IMD_2018_development.png)
:::
:::

::: notes
-   Remember the number of entries. This will be important.
:::

## Background: Census wrangling {.smaller}

```{r Census code nonsense, echo=TRUE}
# Necessary for importing data nicely
library(tidyverse)

# Importing and cleaning education data
education <- read_csv("2018-census-place-summaries-csv/2018-census-place-summaries-education-table2-2018-csv.csv") %>%
  filter(Area_type == "Statistical Area 2")
education <- education %>%
  filter(Maori_ethnic_group_indicator_summary_description == "Total") %>%
  select(Year, Area_type, Area_code, Highest_qualification_description, Highest_qualification_percent) %>%
  pivot_wider(names_from = Highest_qualification_description, values_from = Highest_qualification_percent) %>%
  select(!c(`Not elsewhere included`, Total))

# Importing and cleaning ethnicity data
ethnicity <- read_csv("2018-census-place-summaries-csv/2018-census-place-summaries-ethnicity-table1-2018-csv.csv") %>%
  filter(Area_type == "Statistical Area 2")
ethnicity <- ethnicity %>%
  select(Year, Area_type, Area_code, Maori_descent_description, Maori_descent_indicator_percent) %>%
  pivot_wider(names_from = Maori_descent_description, values_from = Maori_descent_indicator_percent) %>%
  select(!c(`Response unidentifiable`, `Not stated`, `Total`))

# Cleaning transport data, spitting out the percentage of modes used for work, selecting SA2
transport <- read_csv("2018-census-place-summaries-csv/2018-census-place-summaries-transport-table1-2018-csv.csv")
transport <- transport %>%
  select(Year, Area_type, Area_code, `Main_means_of_travel_to_work_description`, `Main_means_of_travel_to_work_percent`) %>%
  pivot_wider(names_from = `Main_means_of_travel_to_work_description`, values_from = `Main_means_of_travel_to_work_percent`) %>%
  filter(Area_type == "Statistical Area 2") %>%
  select(!c(`Did not go to work today`, `Not elsewhere included`))

# Binding the census data together
vars <- left_join(education, ethnicity, by = "Area_code") %>%
  left_join(., transport, by = "Area_code")
vars <- vars %>%
  select(!c(Year, Year.y, Area_type.y, Area_type.x, Area_type)) %>%
  rename(
    `Total Education` = `Total stated.x`,
    `Year` = Year.x,
    `Total Ethnicity` = `Total stated.y`,
    `Total Transport` = `Total stated`
  )

# Creating groupings for education
vars <- vars %>%
  mutate(
    Secondary = as.numeric(`Level 1 certificate`) + as.numeric(`Level 2 certificate`) + as.numeric(`Level 3 certificate`) + as.numeric(`Overseas secondary school qualification`),
    `Some University` = as.numeric(`Level 4 certificate`) + as.numeric(`Level 5 diploma`) + as.numeric(`Level 6 diploma`),
    Tertiary = as.numeric(`Bachelor's degree and level 7 qualification`) + as.numeric(`Post-graduate and honours degrees`),
    `Post-tertiary` = as.numeric(`Master's degree`) + as.numeric(`Doctorate degree`),
    `Any University` = as.numeric(`Level 4 certificate`) + as.numeric(`Level 5 diploma`) + as.numeric(`Bachelor's degree and level 7 qualification`) + as.numeric(`Post-graduate and honours degrees`) + as.numeric(`Master's degree`) + as.numeric(`Doctorate degree`)
    ) %>%
  select(!c(`Level 1 certificate`, `Level 2 certificate`, `Level 3 certificate`,
            `Level 4 certificate`, `Level 5 diploma`, `Level 6 diploma`,
            `Bachelor's degree and level 7 qualification`, `Post-graduate and honours degrees`,
            `Master's degree`, `Doctorate degree`))
```

::: notes
-   Looks worse than it is.
-   Filtering a lot of big data into something usable: percentage values by SA2 of % Maori, % Highest level of education, and % Mode of transport to work.
-   Gets written to a .csv for more horrors.
:::

## Background: Census wrangling

And this is where a lot of problems that have been building come to a head.

. . .

2013 Census Areas $=$ 2013 IMD Data zones

. . .

2018 Statistical Area 2 $\neq$ 2018 IMD Data zones

. . .

2018 Statistical Area 2 $<$ 2018 IMD Data zones

::: notes
In 2018, Census New Zealand reclassified their census districts to be better equipped for the modern age of data, resizing their census areas into *census mesh blocks*, *statistical area one*, and *statistical area two*. The IMD is based on the old 2013 census standard and provides a key for *statistical area one*, not *statistical area 2*, which is bigger than the IMD blocks.
:::

## Background: Census wrangling

::: incremental
-   Imported SA2 Boundaries, census data, and IMD18 data to ArcGIS Pro
-   Education, Ethnicity, and Transport data was joined to the SA2 Boundaries
-   Using a spatial join (greatest overlap), census data was joined to the IMD18 data.
:::

. . .

::: columns
::: {.column width="50%"}
![](join_sa2.png){fig-align="center"}
:::

::: {.column width="50%"}
![](spaital_join.png){fig-align="center"}
:::
:::

# Methods

## Methods: Ordinal data

The IMD is a form of ordinal level data. Each data zone is ranked 1:6181, with a rank of 1 indicating the lowest deprivation and 6181 the highest. Thus, to investigate the data I primarily used methods that accepted ordinal data but did use it in a linear regression.

```{r importing data}
#| echo = FALSE
analysis <- read_csv("data.csv")
analysis <- analysis %>%
  mutate(
    log_maori = log(Maori),
    log_bus = log(Bus),
    log_bike = log(Bicycle1)
  )
```

## Methods: Hypotheses {.incremental}

-   There will be greater deprivation with less education qualifications

    -   And the inverse, that there will be less deprivation with more education qualifications

-   There will be less deprivation with greater private car and bicycle use

-   There will be more deprivation with greater bus use

-   There will be greater deprivation in areas of greater Maori ethnicity

## Methods: Variables {.smaller}

To avoid an inherent correlation between the predictors and the response variable, I chose to use the Index of Multiple Deprivation that excludes education data.

::: columns
::: {.column width="40%"}
**Response**

`RnkIMDNoEdu`: Ranked index of multiple deprivation that was made without education data.
:::

::: {.column width="60%"}
**Predictors**

`No_qual`: % of people with no proof of education

`AnyUni`: % of people who have any university education

`Master_`: % of people with post-bachelor's education

`Maori`: % of people with Maori heritage

`Drive_priv`: % of people who drive their own vehicle to work

`Bus`: % of people who take the bus to work

`Bike`: % of people who bike to work
:::
:::

## Methods: Normality

![](scattermatrix_notransform.png){fig-align="center"}

::: notes
-   Uniform IMD

-   Normalish `No Qualifications` and `Any University`

-   Right skewed `Post-tertiary`

-   Left skewed `Drive`

-   Likely logistic `Bicycle`, `Bus`, and `Maori`
:::

## Methods: Transformations

![](scattermatrix_transformed.png){fig-align="center"}

::: notes
log transform on Bikes, Maori, and Bus; Bikes and Maori appear normal(ish) and linear; bus appears relatively uniform with many similar observations
:::

## Methods: Analysis {.smaller}

-   Spearman Correlation

    -   ordinal test for correlation within data, ranging from 1 (positively correlated) to -1 (negatively correlated)

-   Moran's I

    -   Test for spatial correlation of the data (run on the response variable)

-   Linear Regression

    -   Requires independence of variables, normality of residuals, and homoscedasticity of residuals

    -   Spatial Lag Regression with Queen weighting

    -   Spatial Error Regression with Queen weighting

# Results

## Results: Spearman Correlation {.smaller}

```{r spearman}
spearman <- analysis %>% 
  select(RnkIMDNoEd, No_qual, log_maori, Drive_priv, log_bus, Masters_, AnyUni, log_bike) %>% 
  cor(method = "spearman")
```

![](Screenshot%20from%202023-04-04%2023-00-46.png){fig-align="center"}

Pearson correlation coefficients, which range from $1:-1$.

```{r significance spearman}
#| echo = FALSE
symnum(spearman)
```

The significance level of each Spearman correlation is notated at the bottom.

## Methods: Global Moran's I

![](imdnoed_globalmoranI_uni.png){fig-align="center"}

## Methods: Local Moran's I

::: columns
::: {.column width="50%"}
![](imdnoed_localmoranI_uni_clustermap.png){fig-align="center"}
:::

::: {.column width="50%"}
![](imdnoed_localmoranI_uni_significance%20map.png)
:::
:::

## Results: Multiple Linear Regression

![](ols_full.png){fig-align="center"}

::: notes
Collinearity between `Any_University` and `Master_`, removed that
:::

## Results: Multiple Linear Regression

![](ols_noanyuni.png){fig-align="center"}

## Results: Assumptions of Multiple Linear Regression {.smaller}

::: columns
::: {.column width="33%"}
**Normality of residuals**

![Histogram of residuals, right skewed](ols_noanyuni_residuals.png)
:::

::: {.column width="33%"}
**Heteroscedasticity**

Results of Breusch-Pagan test reject the null hypothesis of homoscedasticity with a p-value of 0, confirming that the residuals are heteroscedastic.
:::

::: {.column width="33%"}
**No collinearity**

With Geoda's multicollinearity condition number of 33.22, there may be some collinearity between the predictors, though it improved significantly after the removal of `Master_`.
:::
:::

::: notes
Hard right skew in histogram -\> not super normal residuals
:::

## Results: Spatial Lag Linear Regression

::: columns
::: {.column width="50%"}
![](ols_spatiallag_noanyuni.png){fig-align="center" width="1000"}
:::

::: {.column width="50%"}
![Histogram of residuals](ols_spatiallag_noanyuni_residuals.png){fig-align="center" width="1100"}
:::
:::

::: notes
For the spatial models, `Any_uni` was also removed due to its relation to `No_qual`.
:::

## Results: Spatial Error Linear Regression

::: columns
::: {.column width="50%"}
![](ols_spatialerror_noanyuni.png){fig-align="center" width="1000"}
:::

::: {.column width="50%"}
![Histogram of residuals](ols_spatialerror_noanyuni_residuals.png){fig-align="center"}
:::
:::

# Conclusions

## Conclusions

Ultimately, we can conclude that bike riding, Maori ethnicity, lack of educational qualifications, bus ridership, and car driving function well as predictors of depravation, particularly when accounting for the spatial differences in the data.

## Works cited
